# 数学公式功能使用指南

## 概述

本应用支持使用 LaTeX 语法渲染数学公式，基于 KaTeX 引擎提供高质量的数学公式显示。支持行内公式和块级公式两种模式。

## 基本语法

### 行内公式
使用单个美元符号 `$` 包围公式：
```
这是一个行内公式：$E = mc^2$
```
渲染效果：这是一个行内公式：$E = mc^2$

### 块级公式
使用双美元符号 `$$` 包围公式：
```
$$
\int_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi}
$$
```
渲染效果：
$$
\int_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi}
$$

## 支持的数学符号和功能

### 基本运算符
- 加减乘除：`+`, `-`, `\times`, `\div`
- 分数：`\frac{a}{b}`
- 上标：`x^2`, `x^{n+1}`
- 下标：`x_1`, `x_{i,j}`
- 根号：`\sqrt{x}`, `\sqrt[n]{x}`

### 希腊字母
- 小写：`\alpha`, `\beta`, `\gamma`, `\delta`, `\epsilon`, `\theta`, `\lambda`, `\mu`, `\pi`, `\sigma`, `\phi`, `\omega`
- 大写：`\Alpha`, `\Beta`, `\Gamma`, `\Delta`, `\Theta`, `\Lambda`, `\Pi`, `\Sigma`, `\Phi`, `\Omega`

### 数学集合符号
- 实数集：`\RR` 或 `\mathbb{R}`
- 自然数集：`\NN` 或 `\mathbb{N}`
- 整数集：`\ZZ` 或 `\mathbb{Z}`
- 有理数集：`\QQ` 或 `\mathbb{Q}`
- 复数集：`\CC` 或 `\mathbb{C}`

### 关系符号
- 等于：`=`
- 不等于：`\neq`
- 大于等于：`\geq`
- 小于等于：`\leq`
- 约等于：`\approx`
- 属于：`\in`
- 不属于：`\notin`
- 包含：`\subset`, `\subseteq`

### 积分和求和
- 积分：`\int`, `\iint`, `\iiint`
- 求和：`\sum_{i=1}^{n}`
- 乘积：`\prod_{i=1}^{n}`
- 极限：`\lim_{x \to \infty}`

### 矩阵
```latex
$$
\begin{pmatrix}
a & b \\
c & d
\end{pmatrix}
$$
```

### 多行公式
```latex
$$
\begin{align}
f(x) &= ax^2 + bx + c \\
&= a(x + \frac{b}{2a})^2 - \frac{b^2 - 4ac}{4a}
\end{align}
$$
```

## 特殊功能

### 复制功能
- **行内公式**：点击行内公式可以复制其 LaTeX 源码
- **块级公式**：暂不支持直接复制，可以通过选择文本复制

### 错误处理
当公式语法错误时，系统会：
1. 显示原始的 LaTeX 代码
2. 在控制台输出错误信息
3. 使用红色背景标识错误公式

### 响应式设计
- **桌面端**：正常大小显示，支持悬停效果
- **平板端**：适当缩小字体，保持可读性
- **手机端**：进一步优化字体大小和间距，支持横向滚动

### 深色模式支持
- 自动适配深色主题
- 不同类型的数学符号使用不同颜色：
  - 运算符：绿色
  - 关系符：蓝色
  - 二元运算符：橙色
  - 括号：粉色

## 使用示例

### 基础数学
```
线性方程：$ax + b = 0$
二次公式：$x = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a}$
```

### 微积分
```
导数：$\frac{d}{dx}f(x) = \lim_{h \to 0} \frac{f(x+h) - f(x)}{h}$
积分：$\int_a^b f(x) dx = F(b) - F(a)$
```

### 线性代数
```
矩阵乘法：$\mathbf{C} = \mathbf{A} \mathbf{B}$
特征值：$\mathbf{A} \mathbf{v} = \lambda \mathbf{v}$
```

### 概率统计
```
正态分布：$f(x) = \frac{1}{\sigma\sqrt{2\pi}} e^{-\frac{(x-\mu)^2}{2\sigma^2}}$
贝叶斯定理：$P(A|B) = \frac{P(B|A)P(A)}{P(B)}$
```

## 注意事项

1. **语法严格性**：LaTeX 语法对大小写和符号敏感，请确保语法正确
2. **性能考虑**：复杂公式可能影响渲染性能，建议适度使用
3. **兼容性**：基于 KaTeX 引擎，支持大部分常用 LaTeX 数学命令
4. **流式渲染**：在 AI 回复过程中，数学公式会实时渲染
5. **错误恢复**：语法错误不会影响其他内容的正常显示

## 技术实现

- **渲染引擎**：KaTeX v0.16.x
- **Markdown 解析**：react-markdown + remark-math + rehype-katex
- **样式优化**：自定义 CSS 样式，支持深色模式和响应式设计
- **错误处理**：自定义错误边界，优雅处理渲染失败

## 更新日志

- **v1.0.0**：基础数学公式渲染功能
- **v1.1.0**：添加复制功能和错误处理
- **v1.2.0**：优化深色模式和移动端适配
- **v1.3.0**：性能优化和流式渲染支持