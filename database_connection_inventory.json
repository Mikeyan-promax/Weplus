{
  "summary": {
    "total_files": 27,
    "total_connections": 353,
    "compatibility_issues": 54
  },
  "connections": {
    "auth_routes.py": [
      {
        "type": "INSERT",
        "line": 150,
        "code": "INSERT INTO users (email, username, password_hash, profile)\n            VALUES (?, ?, ?, ?)\n        \"\"\", (email, username, password_hash, '{}'))\n        \n        user_id = cursor.lastrowid\n        con...",
        "context": "INSERT INTO users (email, username, password_hash, profile)"
      },
      {
        "type": "SELECT",
        "line": 119,
        "code": "SELECT id, email, username, password_hash, is_active, is_verified,\n                   created_at, updated_at, last_login, profile\n            FROM users WHERE email = ?\n        \"\"\", (email,))\n        ...",
        "context": "SELECT id, email, username, password_hash, is_active, is_verified,"
      },
      {
        "type": "UPDATE",
        "line": 120,
        "code": "updated_at, last_login, profile\n            FROM users WHERE email = ?\n        \"\"\", (email,))\n        \n        row = cursor.fetchone()\n        if row:\n            return {\n                'id': row[0]...",
        "context": "created_at, updated_at, last_login, profile"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 118,
        "code": "cursor.execute(\"\"\"\n            SELECT id, email, username, password_hash, is_active, is_verified,\n                   created_at, updated_at, last_login, profile\n            FROM users WHERE email = ?\n...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 149,
        "code": "cursor.execute(\"\"\"\n            INSERT INTO users (email, username, password_hash, profile)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 158,
        "code": "cursor.execute(\"\"\"\n            SELECT id, email, username, password_hash, is_active, is_verified,\n                   created_at, updated_at, last_login, profile\n            FROM users WHERE id = ?\n   ...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 185,
        "code": "cursor.execute(\"\"\"\n            UPDATE users SET is_verified = ?, updated_at = CURRENT_TIMESTAMP\n            WHERE email = ?\n        \"\"\", (is_verified, email)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 198,
        "code": "cursor.execute(\"\"\"\n            UPDATE users SET last_login = CURRENT_TIMESTAMP, updated_at = CURRENT_TIMESTAMP\n            WHERE id = ?\n        \"\"\", (user_id,)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 434,
        "code": "cursor.execute(\"\"\"\n                SELECT id, email, username, password_hash, is_active, is_verified,\n                       created_at, updated_at, last_login, profile\n                FROM users WHER...",
        "context": "cursor.execute(\"\"\""
      }
    ],
    "check_db.py": [
      {
        "type": "sqlite3_connect",
        "line": 5,
        "code": "sqlite3.connect('database/users.db')",
        "context": "conn = sqlite3.connect('database/users.db')"
      },
      {
        "type": "SELECT",
        "line": 9,
        "code": "SELECT name FROM sqlite_master WHERE type='table'\")\ntables = cursor.fetchall()\nprint(\"Tables:\", tables)\n\n# 检查users表结构\ncursor.execute(\"PRAGMA table_info(users)\")\nschema = cursor.fetchall()\nprint(\"Users...",
        "context": "cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table'\")"
      },
      {
        "type": "PRAGMA",
        "line": 14,
        "code": "PRAGMA table_info(users)\")\nschema = cursor.fetchall()\nprint(\"Users table schema:\", schema)\n\n# 检查users表中的数据\ncursor.execute(\"SELECT COUNT(*) FROM users\")\ncount = cursor.fetchone()[0]\nprint(f\"Total users...",
        "context": "cursor.execute(\"PRAGMA table_info(users)\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 9,
        "code": "cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table'\")",
        "context": "cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table'\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 14,
        "code": "cursor.execute(\"PRAGMA table_info(users)",
        "context": "cursor.execute(\"PRAGMA table_info(users)\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 19,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM users\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 24,
        "code": "cursor.execute(\"SELECT * FROM users LIMIT 3\")",
        "context": "cursor.execute(\"SELECT * FROM users LIMIT 3\")"
      }
    ],
    "check_db_schema.py": [
      {
        "type": "sqlite3_connect",
        "line": 18,
        "code": "sqlite3.connect(str(db_path)",
        "context": "conn = sqlite3.connect(str(db_path))"
      },
      {
        "type": "UPDATE",
        "line": 47,
        "code": "UPDATE resource_categories SET code = 'category_' || id WHERE code IS NULL\")\n                print(\"✅ 为现有记录设置了默认code值\")\n                \n                conn.commit()\n            except Exception as e...",
        "context": "cursor.execute(\"UPDATE resource_categories SET code = 'category_' || id WHERE code IS NULL\")"
      },
      {
        "type": "PRAGMA",
        "line": 23,
        "code": "PRAGMA table_info(resource_categories)\")\n        columns = cursor.fetchall()\n        \n        if not columns:\n            print(\"❌ resource_categories表不存在\")\n        else:\n            print(\"✅ resource...",
        "context": "cursor.execute(\"PRAGMA table_info(resource_categories)\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 23,
        "code": "cursor.execute(\"PRAGMA table_info(resource_categories)",
        "context": "cursor.execute(\"PRAGMA table_info(resource_categories)\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 43,
        "code": "cursor.execute(\"ALTER TABLE resource_categories ADD COLUMN code VARCHAR(50)",
        "context": "cursor.execute(\"ALTER TABLE resource_categories ADD COLUMN code VARCHAR(50)\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 47,
        "code": "cursor.execute(\"UPDATE resource_categories SET code = 'category_' || id WHERE code IS NULL\")",
        "context": "cursor.execute(\"UPDATE resource_categories SET code = 'category_' || id WHERE code IS NULL\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 56,
        "code": "cursor.execute(\"PRAGMA table_info(study_resources)",
        "context": "cursor.execute(\"PRAGMA table_info(study_resources)\")"
      }
    ],
    "check_db_temp.py": [
      {
        "type": "sqlite3_connect",
        "line": 12,
        "code": "sqlite3.connect(db_path)",
        "context": "conn = sqlite3.connect(db_path)"
      },
      {
        "type": "SELECT",
        "line": 16,
        "code": "SELECT name FROM sqlite_master WHERE type='table' AND name='admin_users'\")\n    table_exists = cursor.fetchone()\n    print(f'admin_users表存在: {table_exists is not None}')\n    \n    if table_exists:\n     ...",
        "context": "cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table' AND name='admin_users'\")"
      },
      {
        "type": "PRAGMA",
        "line": 27,
        "code": "PRAGMA table_info(admin_users)\")\n        columns = cursor.fetchall()\n        print('\\n表结构:')\n        for col in columns:\n            print(f'  {col[1]} ({col[2]})')\n        \n        # 查询前5个用户的基本信息\n   ...",
        "context": "cursor.execute(\"PRAGMA table_info(admin_users)\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 16,
        "code": "cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table' AND name='admin_users'\")",
        "context": "cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table' AND name='admin_users'\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 22,
        "code": "cursor.execute('SELECT COUNT(*)",
        "context": "cursor.execute('SELECT COUNT(*) FROM admin_users')"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 27,
        "code": "cursor.execute(\"PRAGMA table_info(admin_users)",
        "context": "cursor.execute(\"PRAGMA table_info(admin_users)\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 34,
        "code": "cursor.execute('SELECT * FROM admin_users LIMIT 5')",
        "context": "cursor.execute('SELECT * FROM admin_users LIMIT 5')"
      }
    ],
    "check_tables.py": [
      {
        "type": "sqlite3_connect",
        "line": 6,
        "code": "sqlite3.connect('database/weplus.db')",
        "context": "conn = sqlite3.connect('database/weplus.db')"
      },
      {
        "type": "sqlite3_connect",
        "line": 23,
        "code": "sqlite3.connect('database/users.db')",
        "context": "conn = sqlite3.connect('database/users.db')"
      },
      {
        "type": "SELECT",
        "line": 9,
        "code": "SELECT name FROM sqlite_master WHERE type='table'\")\n    tables = cursor.fetchall()\n    \n    print(\"数据库中的表:\")\n    for table in tables:\n        print(f\"- {table[0]}\")\n    \n    conn.close()\nexcept Except...",
        "context": "cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table'\")"
      },
      {
        "type": "PRAGMA",
        "line": 35,
        "code": "PRAGMA table_info(users)\")\n        columns = cursor.fetchall()\n        print(\"\\nusers表结构:\")\n        for col in columns:\n            print(f\"  {col[1]} {col[2]}\")\n    \n    conn.close()\nexcept Exception...",
        "context": "cursor.execute(\"PRAGMA table_info(users)\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 9,
        "code": "cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table'\")",
        "context": "cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table'\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 26,
        "code": "cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table'\")",
        "context": "cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table'\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 35,
        "code": "cursor.execute(\"PRAGMA table_info(users)",
        "context": "cursor.execute(\"PRAGMA table_info(users)\")"
      }
    ],
    "check_users_table.py": [
      {
        "type": "sqlite3_connect",
        "line": 11,
        "code": "sqlite3.connect(str(db_path)",
        "context": "conn = sqlite3.connect(str(db_path))"
      },
      {
        "type": "SELECT",
        "line": 15,
        "code": "SELECT name FROM sqlite_master WHERE type='table' AND name='users'\")\n    users_table_exists = cursor.fetchone() is not None\n    print(f'users表存在: {users_table_exists}')\n    \n    if users_table_exists:...",
        "context": "cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table' AND name='users'\")"
      },
      {
        "type": "PRAGMA",
        "line": 26,
        "code": "PRAGMA table_info(users)\")\n        columns = cursor.fetchall()\n        print('\\nusers表结构:')\n        for col in columns:\n            print(f'  {col[1]} ({col[2]})')\n        \n        # 查询前5个用户的基本信息\n    ...",
        "context": "cursor.execute(\"PRAGMA table_info(users)\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 15,
        "code": "cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table' AND name='users'\")",
        "context": "cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table' AND name='users'\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 21,
        "code": "cursor.execute('SELECT COUNT(*)",
        "context": "cursor.execute('SELECT COUNT(*) FROM users')"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 26,
        "code": "cursor.execute(\"PRAGMA table_info(users)",
        "context": "cursor.execute(\"PRAGMA table_info(users)\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 33,
        "code": "cursor.execute('SELECT * FROM users LIMIT 5')",
        "context": "cursor.execute('SELECT * FROM users LIMIT 5')"
      }
    ],
    "test_api.py": [
      {
        "type": "sqlite3_connect",
        "line": 9,
        "code": "sqlite3.connect(sqlite_config.database_path)",
        "context": "conn = sqlite3.connect(sqlite_config.database_path)"
      },
      {
        "type": "SELECT",
        "line": 13,
        "code": "SELECT COUNT(*) FROM users\")\n        total_users = cursor.fetchone()[0]\n        print(f\"Total users: {total_users}\")\n        \n        cursor.execute(\"SELECT COUNT(*) FROM users WHERE is_active = 1\")\n ...",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM users\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 13,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM users\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 17,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM users WHERE is_active = 1\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 21,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM users WHERE is_verified = 1\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 26,
        "code": "cursor.execute(\"\"\"\n            SELECT COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 35,
        "code": "cursor.execute(\"\"\"\n            SELECT COUNT(*)",
        "context": "cursor.execute(\"\"\""
      }
    ],
    "user_management_api.py": [
      {
        "type": "SELECT",
        "line": 103,
        "code": "SELECT COUNT(*) FROM users {where_clause}\"\n        cursor.execute(count_query, params)\n        total = cursor.fetchone()[0]\n        \n        # 获取分页数据\n        offset = (page - 1) * limit\n        data_q...",
        "context": "count_query = f\"SELECT COUNT(*) FROM users {where_clause}\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 104,
        "code": "cursor.execute(count_query, params)",
        "context": "cursor.execute(count_query, params)"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 115,
        "code": "cursor.execute(data_query, params + [limit, offset])",
        "context": "cursor.execute(data_query, params + [limit, offset])"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 163,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM users\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 167,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM users WHERE is_active = 1\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 171,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM users WHERE is_active = 0\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 177,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM users WHERE DATE(created_at) = ?\", (today,))"
      }
    ],
    "app\\api\\admin_dashboard_api.py": [
      {
        "type": "SELECT",
        "line": 114,
        "code": "SELECT COUNT(*) FROM admin_users WHERE is_deleted = 0\")\n        total_users = cursor.fetchone()[0]\n        \n        cursor.execute(\"SELECT COUNT(*) FROM admin_users WHERE is_deleted = 0 AND is_active ...",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM admin_users WHERE is_deleted = 0\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 114,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM admin_users WHERE is_deleted = 0\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 117,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM admin_users WHERE is_deleted = 0 AND is_active = 1\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 120,
        "code": "cursor.execute(\"\"\"\n            SELECT COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 127,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*), COALESCE(SUM(file_size), 0) FROM file_records WHERE is_deleted = 0\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 133,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM knowledge_entries WHERE is_deleted = 0\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 136,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM knowledge_entries WHERE is_deleted = 0 AND is_active = 1\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 171,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM admin_users WHERE is_deleted = 0\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 174,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM admin_users WHERE is_deleted = 0 AND is_verified = 1\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 180,
        "code": "cursor.execute(\"\"\"\n            SELECT COUNT(DISTINCT user_id)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 186,
        "code": "cursor.execute(\"\"\"\n            SELECT COUNT(DISTINCT user_id)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 193,
        "code": "cursor.execute(\"\"\"\n            SELECT COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 199,
        "code": "cursor.execute(\"\"\"\n            SELECT COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 206,
        "code": "cursor.execute(\"\"\"\n            SELECT DATE(created_at)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 217,
        "code": "cursor.execute(\"\"\"\n            SELECT u.user_id, u.username, u.email, COUNT(l.id)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 259,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*), COALESCE(SUM(file_size), 0) FROM file_records WHERE is_deleted = 0\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 265,
        "code": "cursor.execute(\"\"\"\n            SELECT file_type, COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 273,
        "code": "cursor.execute(\"\"\"\n            SELECT category, COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 281,
        "code": "cursor.execute(\"\"\"\n            SELECT DATE(created_at)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 292,
        "code": "cursor.execute(\"\"\"\n            SELECT f.uploaded_by, u.username, COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 313,
        "code": "cursor.execute(\"\"\"\n            SELECT f.uploaded_by, u.username, COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 334,
        "code": "cursor.execute(\"\"\"\n            SELECT processing_status, COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 362,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM knowledge_entries WHERE is_deleted = 0\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 365,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM knowledge_entries WHERE is_deleted = 0 AND is_active = 1\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 368,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM knowledge_entries WHERE is_deleted = 0 AND vector_id IS NOT NULL\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 372,
        "code": "cursor.execute(\"\"\"\n            SELECT category, COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 380,
        "code": "cursor.execute(\"\"\"\n            SELECT source_type, COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 388,
        "code": "cursor.execute(\"\"\"\n            SELECT COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 402,
        "code": "cursor.execute(\"\"\"\n            SELECT id, title, access_count, last_accessed\n            FROM knowledge_entries \n            WHERE is_deleted = 0 AND access_count > 0\n            ORDER BY access_count...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 454,
        "code": "cursor.execute(\"\"\"\n            SELECT id, user_id, action, resource_type, resource_id, \n                   details, ip_address, user_agent, timestamp\n            FROM admin_logs \n            ORDER BY ...",
        "context": "cursor.execute(\"\"\""
      }
    ],
    "app\\api\\admin_file_api.py": [
      {
        "type": "INSERT",
        "line": 192,
        "code": "INSERT INTO file_records (\n                filename, original_filename, file_path, file_size, file_type,\n                mime_type, file_hash, category_id, uploaded_by, processing_status\n            )...",
        "context": "INSERT INTO file_records ("
      },
      {
        "type": "SELECT",
        "line": 222,
        "code": "SELECT id, filename, original_filename, file_path, file_size, file_type,\n                   mime_type, file_hash, category_id, uploaded_by, upload_time,\n                   processing_status, download_...",
        "context": "SELECT id, filename, original_filename, file_path, file_size, file_type,"
      },
      {
        "type": "UPDATE",
        "line": 127,
        "code": "update(chunk)\n    return hash_md5.hexdigest()\n\ndef get_file_type_from_extension(filename: str) -> str:\n    \"\"\"根据文件扩展名获取文件类型\"\"\"\n    ext = filename.lower().split('.')[-1] if '.' in filename else ''\n    ...",
        "context": "hash_md5.update(chunk)"
      },
      {
        "type": "DELETE",
        "line": 645,
        "code": "DELETE FROM file_categories WHERE id = ?\", (category_id,))\n        conn.commit()\n        \n        logger.info(f\"文件分类删除成功: category_id={category_id}\")\n        \n        return {\"message\": \"分类删除成功\"}\n    ...",
        "context": "cursor.execute(\"DELETE FROM file_categories WHERE id = ?\", (category_id,))"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 191,
        "code": "cursor.execute(\"\"\"\n            INSERT INTO file_records (\n                filename, original_filename, file_path, file_size, file_type,\n                mime_type, file_hash, category_id, uploaded_by, ...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 221,
        "code": "cursor.execute(\"\"\"\n            SELECT id, filename, original_filename, file_path, file_size, file_type,\n                   mime_type, file_hash, category_id, uploaded_by, upload_time,\n                ...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 358,
        "code": "cursor.execute(f\"\"\"\n            SELECT COUNT(*)",
        "context": "cursor.execute(f\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 365,
        "code": "cursor.execute(f\"\"\"\n            SELECT f.id, f.filename, f.original_filename, f.file_size, f.file_type,\n                   f.mime_type, f.uploaded_by, f.upload_time, f.processing_status,\n             ...",
        "context": "cursor.execute(f\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 416,
        "code": "cursor.execute(\"\"\"\n            SELECT COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 423,
        "code": "cursor.execute(\"\"\"\n            SELECT file_type, COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 431,
        "code": "cursor.execute(\"\"\"\n            SELECT COALESCE(c.name, '未分类')",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 441,
        "code": "cursor.execute(\"\"\"\n            SELECT COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 448,
        "code": "cursor.execute(\"\"\"\n            SELECT COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 499,
        "code": "cursor.execute(\"\"\"\n            UPDATE file_records \n            SET is_deleted = 1, updated_at = ?\n            WHERE id = ?\n        \"\"\", (datetime.now()",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 533,
        "code": "cursor.execute(\"\"\"\n            SELECT c.id, c.name, c.description, c.created_at,\n                   COUNT(f.id)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 572,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM file_categories WHERE name = ?\", (category_data.name,))"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 580,
        "code": "cursor.execute(\"\"\"\n            INSERT INTO file_categories (name, description)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 589,
        "code": "cursor.execute(\"\"\"\n            SELECT id, name, description, created_at FROM file_categories WHERE id = ?\n        \"\"\", (category_id,)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 625,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM file_categories WHERE id = ?\", (category_id,))"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 633,
        "code": "cursor.execute(\"\"\"\n            SELECT COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 645,
        "code": "cursor.execute(\"DELETE FROM file_categories WHERE id = ?\", (category_id,)",
        "context": "cursor.execute(\"DELETE FROM file_categories WHERE id = ?\", (category_id,))"
      }
    ],
    "app\\api\\admin_rag_api.py": [
      {
        "type": "INSERT",
        "line": 206,
        "code": "INSERT INTO knowledge_entries (\n                title, content, content_hash, source_type, source_id, category,\n                tags, similarity_threshold, is_active, created_by, metadata\n            ...",
        "context": "INSERT INTO knowledge_entries ("
      },
      {
        "type": "SELECT",
        "line": 195,
        "code": "SELECT COUNT(*) FROM knowledge_entries WHERE content_hash = ? AND is_deleted = 0\",\n            (content_hash,)\n        )\n        if cursor.fetchone()[0] > 0:\n            raise HTTPException(\n         ...",
        "context": "\"SELECT COUNT(*) FROM knowledge_entries WHERE content_hash = ? AND is_deleted = 0\","
      },
      {
        "type": "UPDATE",
        "line": 52,
        "code": "UpdateRequest(BaseModel):\n    \"\"\"知识条目更新请求模型\"\"\"\n    title: Optional[str] = None\n    content: Optional[str] = None\n    category: Optional[str] = None\n    tags: Optional[List[str]] = None\n    metadata: O...",
        "context": "class KnowledgeUpdateRequest(BaseModel):"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 194,
        "code": "cursor.execute(\n            \"SELECT COUNT(*)",
        "context": "cursor.execute("
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 205,
        "code": "cursor.execute(\"\"\"\n            INSERT INTO knowledge_entries (\n                title, content, content_hash, source_type, source_id, category,\n                tags, similarity_threshold, is_active, cr...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 245,
        "code": "cursor.execute(\"\"\"\n            SELECT id, title, content, content_hash, source_type, source_id,\n                   category, tags, vector_id, embedding_model, similarity_threshold,\n                   ...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 286,
        "code": "cursor.execute(\"\"\"\n            UPDATE knowledge_entries \n            SET vector_id = ?, embedding_model = ?, updated_at = ?\n            WHERE id = ?\n        \"\"\", (vector_id, EMBEDDING_MODEL, datetime....",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 293,
        "code": "cursor.execute(\"\"\"\n            INSERT OR REPLACE INTO vector_metadata (\n                entry_id, vector_id, vector_data, dimension, model_name\n            )",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 397,
        "code": "cursor.execute(f\"SELECT COUNT(*)",
        "context": "cursor.execute(f\"SELECT COUNT(*) FROM knowledge_entries WHERE {where_clause}\", params)"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 402,
        "code": "cursor.execute(f\"\"\"\n            SELECT id, title, content, content_hash, source_type, source_id,\n                   category, tags, vector_id, embedding_model, similarity_threshold,\n                  ...",
        "context": "cursor.execute(f\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 471,
        "code": "cursor.execute(\"\"\"\n            UPDATE knowledge_entries \n            SET last_accessed = ?, access_count = access_count + 1\n            WHERE id = ?\n        \"\"\", (datetime.now()",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 567,
        "code": "cursor.execute(f\"\"\"\n            UPDATE knowledge_entries \n            SET {', '.join(update_fields)",
        "context": "cursor.execute(f\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 634,
        "code": "cursor.execute(\"\"\"\n            UPDATE knowledge_entries \n            SET is_deleted = 1, updated_at = ?\n            WHERE id = ?\n        \"\"\", (datetime.now()",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 688,
        "code": "cursor.execute(f\"\"\"\n            SELECT ke.id, ke.title, ke.content, ke.category, ke.tags, ke.source_type,\n                   ke.created_at, vm.vector_data\n            FROM knowledge_entries ke\n       ...",
        "context": "cursor.execute(f\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 742,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM knowledge_entries WHERE is_deleted = 0\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 746,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM knowledge_entries WHERE is_deleted = 0 AND is_active = 1\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 750,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM knowledge_entries WHERE is_deleted = 0 AND vector_id IS NOT NULL\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 754,
        "code": "cursor.execute(\"\"\"\n            SELECT category, COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 761,
        "code": "cursor.execute(\"\"\"\n            SELECT source_type, COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 768,
        "code": "cursor.execute(\"\"\"\n            SELECT COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 775,
        "code": "cursor.execute(\"\"\"\n            SELECT AVG(similarity_threshold)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 819,
        "code": "cursor.execute(f\"\"\"\n                UPDATE knowledge_entries \n                SET is_active = ?, updated_at = ?\n                WHERE id IN ({placeholders})",
        "context": "cursor.execute(f\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 837,
        "code": "cursor.execute(f\"\"\"\n                UPDATE knowledge_entries \n                SET is_deleted = 1, updated_at = ?\n                WHERE id IN ({placeholders})",
        "context": "cursor.execute(f\"\"\""
      }
    ],
    "app\\api\\admin_user_api.py": [
      {
        "type": "sqlite3_connect",
        "line": 155,
        "code": "sqlite3.connect(sqlite_config.db_path)",
        "context": "return sqlite3.connect(sqlite_config.db_path)"
      },
      {
        "type": "INSERT",
        "line": 201,
        "code": "INSERT INTO admin_users (\n                email, username, password_hash, real_name, phone, \n                department, student_id, role, is_active, is_verified\n            ) VALUES (?, ?, ?, ?, ?, ?...",
        "context": "INSERT INTO admin_users ("
      },
      {
        "type": "SELECT",
        "line": 187,
        "code": "SELECT COUNT(*) FROM admin_users WHERE username = ? OR email = ?\",\n            (user_data.username, user_data.email)\n        )\n        if cursor.fetchone()[0] > 0:\n            raise HTTPException(\n   ...",
        "context": "\"SELECT COUNT(*) FROM admin_users WHERE username = ? OR email = ?\","
      },
      {
        "type": "UPDATE",
        "line": 65,
        "code": "UpdateRequest(BaseModel):\n    \"\"\"用户信息更新请求模型\"\"\"\n    email: Optional[EmailStr] = None\n    username: Optional[str] = None\n    real_name: Optional[str] = None\n    phone: Optional[str] = None\n    departmen...",
        "context": "class UserUpdateRequest(BaseModel):"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 186,
        "code": "cursor.execute(\n            \"SELECT COUNT(*)",
        "context": "cursor.execute("
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 200,
        "code": "cursor.execute(\"\"\"\n            INSERT INTO admin_users (\n                email, username, password_hash, real_name, phone, \n                department, student_id, role, is_active, is_verified\n       ...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 239,
        "code": "cursor.execute(\"\"\"\n            SELECT id, email, username, password_hash, real_name, phone,\n                   department, student_id, role, is_active, is_verified,\n                   created_at, upda...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 268,
        "code": "cursor.execute(\"\"\"\n            SELECT id, email, username, password_hash, real_name, phone,\n                   department, student_id, role, is_active, is_verified,\n                   created_at, upda...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 293,
        "code": "cursor.execute(\"\"\"\n                UPDATE admin_users \n                SET last_login = ?, login_count = login_count + 1, updated_at = ?\n                WHERE id = ?\n            \"\"\", (datetime.now()",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 461,
        "code": "cursor.execute(f\"SELECT COUNT(*)",
        "context": "cursor.execute(f\"SELECT COUNT(*) FROM admin_users WHERE {where_clause}\", params)"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 466,
        "code": "cursor.execute(f\"\"\"\n            SELECT id, email, username, real_name, phone, department, student_id,\n                   role, is_active, is_verified, created_at, updated_at, last_login, login_count\n ...",
        "context": "cursor.execute(f\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 584,
        "code": "cursor.execute(f\"\"\"\n            UPDATE admin_users \n            SET {', '.join(update_fields)",
        "context": "cursor.execute(f\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 650,
        "code": "cursor.execute(\"\"\"\n            UPDATE admin_users \n            SET is_active = 0, updated_at = ?\n            WHERE id = ?\n        \"\"\", (datetime.now()",
        "context": "cursor.execute(\"\"\""
      }
    ],
    "app\\api\\document_routes.py": [
      {
        "type": "UPDATE",
        "line": 64,
        "code": "UpdateRequest(BaseModel):\n    name: Optional[str] = None\n    description: Optional[str] = None\n    parent_id: Optional[int] = None\n\nclass TagCreateRequest(BaseModel):\n    name: str\n    color: Optional...",
        "context": "class CategoryUpdateRequest(BaseModel):"
      }
    ],
    "app\\api\\study_resources_api.py": [
      {
        "type": "sqlite3_connect",
        "line": 430,
        "code": "sqlite3.connect(str(db_path)",
        "context": "conn = sqlite3.connect(str(db_path))"
      },
      {
        "type": "SELECT",
        "line": 434,
        "code": "SELECT id FROM resource_ratings \n            WHERE resource_id = ? AND user_id = ?\n        \"\"\", (request.resource_id, user_id))\n        \n        existing_rating = cursor.fetchone()\n        \n        if...",
        "context": "SELECT id FROM resource_ratings"
      },
      {
        "type": "UPDATE",
        "line": 127,
        "code": "update(chunk)\n    return hash_md5.hexdigest()\n\ndef validate_file_type(filename: str) -> bool:\n    \"\"\"验证文件类型\"\"\"\n    ext = filename.lower().split('.')[-1]\n    return ext in ALLOWED_EXTENSIONS\n\ndef get_f...",
        "context": "hash_md5.update(chunk)"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 433,
        "code": "cursor.execute(\"\"\"\n            SELECT id FROM resource_ratings \n            WHERE resource_id = ? AND user_id = ?\n        \"\"\", (request.resource_id, user_id)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 442,
        "code": "cursor.execute(\"\"\"\n                UPDATE resource_ratings \n                SET rating = ?, updated_at = ?\n                WHERE resource_id = ? AND user_id = ?\n            \"\"\", (request.rating, datet...",
        "context": "cursor.execute(\"\"\""
      }
    ],
    "app\\api\\vector_database_api.py": [
      {
        "type": "UPDATE",
        "line": 37,
        "code": "updated: str\n    embedding_model: str\n    vector_dimension: int\n    collections: List[Dict[str, Any]]\n\nclass IndexInfo(BaseModel):\n    \"\"\"索引信息模型\"\"\"\n    name: str\n    type: str\n    size: float  # MB\n  ...",
        "context": "last_updated: str"
      }
    ],
    "app\\models\\document.py": [
      {
        "type": "sqlite3_connect",
        "line": 39,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 71,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 96,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 124,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 150,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 189,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 223,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 246,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 267,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 293,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 332,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 395,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 434,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 472,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 500,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 589,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 640,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 664,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 688,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 717,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 779,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 807,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 853,
        "code": "sqlite3.connect(DB_PATH)",
        "context": "conn = sqlite3.connect(DB_PATH)"
      },
      {
        "type": "sqlite3_connect",
        "line": 891,
        "code": "sqlite3.connect(DB_PATH)",
        "context": "conn = sqlite3.connect(DB_PATH)"
      },
      {
        "type": "sqlite3_connect",
        "line": 924,
        "code": "sqlite3.connect(DB_PATH)",
        "context": "conn = sqlite3.connect(DB_PATH)"
      },
      {
        "type": "sqlite3_connect",
        "line": 964,
        "code": "sqlite3.connect(DB_PATH)",
        "context": "conn = sqlite3.connect(DB_PATH)"
      },
      {
        "type": "CREATE_TABLE",
        "line": 42,
        "code": "CREATE TABLE IF NOT EXISTS categories (\n                        id INTEGER PRIMARY KEY AUTOINCREMENT,\n                        name TEXT NOT NULL UNIQUE,\n                        description TEXT,\n     ...",
        "context": "CREATE TABLE IF NOT EXISTS categories ("
      },
      {
        "type": "INSERT",
        "line": 74,
        "code": "INSERT INTO categories (name, description, color, parent_id, created_at, updated_at)\n                    VALUES (?, ?, ?, ?, ?, ?)\n                ''', (\n                    name, description, categor...",
        "context": "INSERT INTO categories (name, description, color, parent_id, created_at, updated_at)"
      },
      {
        "type": "SELECT",
        "line": 99,
        "code": "SELECT id, name, description, color, parent_id, created_at, updated_at\n                    FROM categories ORDER BY name\n                ''')\n                rows = cursor.fetchall()\n                \n...",
        "context": "SELECT id, name, description, color, parent_id, created_at, updated_at"
      },
      {
        "type": "UPDATE",
        "line": 26,
        "code": "updated_at=None):\n        self.id = id\n        self.name = name\n        self.description = description\n        self.color = color or \"#007bff\"\n        self.parent_id = parent_id\n        self.created_a...",
        "context": "parent_id=None, created_at=None, updated_at=None):"
      },
      {
        "type": "DELETE",
        "line": 191,
        "code": "DELETE FROM categories WHERE id = ?', (category_id,))\n                conn.commit()\n                return cursor.rowcount > 0\n        except Exception as e:\n            logger.error(f\"删除分类失败: {str(e)...",
        "context": "cursor.execute('DELETE FROM categories WHERE id = ?', (category_id,))"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 41,
        "code": "cursor.execute('''\n                    CREATE TABLE IF NOT EXISTS categories (\n                        id INTEGER PRIMARY KEY AUTOINCREMENT,\n                        name TEXT NOT NULL UNIQUE,\n        ...",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 73,
        "code": "cursor.execute('''\n                    INSERT INTO categories (name, description, color, parent_id, created_at, updated_at)",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 98,
        "code": "cursor.execute('''\n                    SELECT id, name, description, color, parent_id, created_at, updated_at\n                    FROM categories ORDER BY name\n                ''')",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 126,
        "code": "cursor.execute('''\n                    SELECT id, name, description, color, parent_id, created_at, updated_at\n                    FROM categories WHERE id = ?\n                ''', (category_id,)",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 174,
        "code": "cursor.execute(f'''\n                    UPDATE categories SET {\", \".join(updates)",
        "context": "cursor.execute(f'''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 191,
        "code": "cursor.execute('DELETE FROM categories WHERE id = ?', (category_id,)",
        "context": "cursor.execute('DELETE FROM categories WHERE id = ?', (category_id,))"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 225,
        "code": "cursor.execute('''\n                    CREATE TABLE IF NOT EXISTS tags (\n                        id INTEGER PRIMARY KEY AUTOINCREMENT,\n                        name TEXT NOT NULL UNIQUE,\n              ...",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 248,
        "code": "cursor.execute('''\n                    INSERT INTO tags (name, color, created_at)",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 269,
        "code": "cursor.execute('''\n                    SELECT id, name, color, created_at\n                    FROM tags ORDER BY name\n                ''')",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 295,
        "code": "cursor.execute('DELETE FROM tags WHERE id = ?', (tag_id,)",
        "context": "cursor.execute('DELETE FROM tags WHERE id = ?', (tag_id,))"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 336,
        "code": "cursor.execute('''\n                    CREATE TABLE IF NOT EXISTS documents (\n                        id INTEGER PRIMARY KEY AUTOINCREMENT,\n                        filename TEXT NOT NULL,\n            ...",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 352,
        "code": "cursor.execute('''\n                    CREATE TABLE IF NOT EXISTS document_tags (\n                        id INTEGER PRIMARY KEY AUTOINCREMENT,\n                        document_id INTEGER NOT NULL,\n  ...",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 397,
        "code": "cursor.execute('''\n                    INSERT INTO documents (filename, file_type, file_size, upload_time, content_hash, doc_metadata, status, category_id)",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 415,
        "code": "cursor.execute('''\n                            INSERT INTO document_tags (document_id, tag_id)",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 436,
        "code": "cursor.execute('''\n                    SELECT d.id, d.filename, d.file_type, d.file_size, d.upload_time, \n                           d.content_hash, d.doc_metadata, d.status, d.category_id\n           ...",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 452,
        "code": "cursor.execute('''\n                        SELECT t.id, t.name, t.color\n                        FROM tags t\n                        JOIN document_tags dt ON t.id = dt.tag_id\n                        WH...",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 474,
        "code": "cursor.execute('''\n                    SELECT id, filename, file_type, file_size, upload_time, content_hash, doc_metadata, status, category_id\n                    FROM documents WHERE content_hash = ?...",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 541,
        "code": "cursor.execute(count_query, params)",
        "context": "cursor.execute(count_query, params)"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 552,
        "code": "cursor.execute(list_query, params + [limit, offset])",
        "context": "cursor.execute(list_query, params + [limit, offset])"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 566,
        "code": "cursor.execute('''\n                        SELECT t.id, t.name, t.color\n                        FROM tags t\n                        JOIN document_tags dt ON t.id = dt.tag_id\n                        WH...",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 610,
        "code": "cursor.execute(f'''\n                        UPDATE documents SET {\", \".join(updates)",
        "context": "cursor.execute(f'''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 617,
        "code": "cursor.execute('DELETE FROM document_tags WHERE document_id = ?', (doc_id,)",
        "context": "cursor.execute('DELETE FROM document_tags WHERE document_id = ?', (doc_id,))"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 621,
        "code": "cursor.execute('''\n                            INSERT INTO document_tags (document_id, tag_id)",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 644,
        "code": "cursor.execute('DELETE FROM documents WHERE id = ?', (doc_id,)",
        "context": "cursor.execute('DELETE FROM documents WHERE id = ?', (doc_id,))"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 668,
        "code": "cursor.execute('UPDATE documents SET category_id = ? WHERE id = ?', (category_id, doc_id)",
        "context": "cursor.execute('UPDATE documents SET category_id = ? WHERE id = ?', (category_id, doc_id))"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 694,
        "code": "cursor.execute('''\n                                INSERT INTO document_tags (document_id, tag_id)",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 721,
        "code": "cursor.execute('SELECT COUNT(*)",
        "context": "cursor.execute('SELECT COUNT(*), SUM(file_size) FROM documents')"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 726,
        "code": "cursor.execute('''\n                    SELECT file_type, COUNT(*)",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 736,
        "code": "cursor.execute('''\n                    SELECT status, COUNT(*)",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 746,
        "code": "cursor.execute('''\n                    SELECT c.name, COUNT(d.id)",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 783,
        "code": "cursor.execute('SELECT id FROM documents WHERE id = ?', (doc_id,)",
        "context": "cursor.execute('SELECT id FROM documents WHERE id = ?', (doc_id,))"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 789,
        "code": "cursor.execute('DELETE FROM documents WHERE id = ?', (doc_id,)",
        "context": "cursor.execute('DELETE FROM documents WHERE id = ?', (doc_id,))"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 809,
        "code": "cursor.execute('''\n                    UPDATE documents SET status = ? WHERE id = ?\n                ''', (status, self.id)",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 856,
        "code": "cursor.execute('''\n            CREATE TABLE IF NOT EXISTS document_chunks (\n                id INTEGER PRIMARY KEY AUTOINCREMENT,\n                document_id INTEGER NOT NULL,\n                chunk_in...",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 895,
        "code": "cursor.execute('''\n                INSERT INTO document_chunks \n                (document_id, chunk_index, content, content_length, chunk_metadata, created_at)",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 928,
        "code": "cursor.execute('''\n                SELECT id, document_id, chunk_index, content, content_length, \n                       chunk_metadata, created_at\n                FROM document_chunks \n              ...",
        "context": "cursor.execute('''"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 968,
        "code": "cursor.execute('''\n                DELETE FROM document_chunks \n                WHERE document_id = ?\n            ''', (document_id,)",
        "context": "cursor.execute('''"
      }
    ],
    "app\\models\\study_resources.py": [
      {
        "type": "sqlite3_connect",
        "line": 36,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 48,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 62,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 107,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 128,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 148,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 173,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 210,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 234,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 267,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 316,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 334,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 363,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 389,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 399,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 409,
        "code": "sqlite3.connect(str(DB_PATH)",
        "context": "with sqlite3.connect(str(DB_PATH)) as conn:"
      },
      {
        "type": "INSERT",
        "line": 110,
        "code": "INSERT INTO study_resources (\n                    name, description, file_name, file_path, file_type, \n                    file_size, category_id, metadata, tags, keywords\n                ) VALUES (?,...",
        "context": "INSERT INTO study_resources ("
      },
      {
        "type": "SELECT",
        "line": 52,
        "code": "SELECT * FROM resource_categories \n                WHERE is_active = 1 \n                ORDER BY sort_order, name\n            \"\"\")\n            rows = cursor.fetchall()\n            return [cls(**dict(r...",
        "context": "SELECT * FROM resource_categories"
      },
      {
        "type": "UPDATE",
        "line": 29,
        "code": "updated_at: Optional[datetime] = None\n\n    @classmethod\n    def init_db(cls):\n        \"\"\"初始化数据库表\"\"\"\n        os.makedirs(DB_PATH.parent, exist_ok=True)\n        \n        with sqlite3.connect(str(DB_PATH...",
        "context": "updated_at: Optional[datetime] = None"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 51,
        "code": "cursor.execute(\"\"\"\n                SELECT * FROM resource_categories \n                WHERE is_active = 1 \n                ORDER BY sort_order, name\n            \"\"\")",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 65,
        "code": "cursor.execute(\"\"\"\n                SELECT * FROM resource_categories \n                WHERE code = ? AND is_active = 1\n            \"\"\", (code,)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 109,
        "code": "cursor.execute(\"\"\"\n                INSERT INTO study_resources (\n                    name, description, file_name, file_path, file_type, \n                    file_size, category_id, metadata, tags, ke...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 131,
        "code": "cursor.execute(\"\"\"\n                SELECT * FROM study_resources WHERE id = ? AND status = 'active'\n            \"\"\", (resource_id,)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 151,
        "code": "cursor.execute(\"\"\"\n                SELECT * FROM study_resources \n                WHERE category_id = ? AND status = 'active'\n                ORDER BY upload_time DESC\n                LIMIT ? OFFSET ?...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 194,
        "code": "cursor.execute(base_query, params)",
        "context": "cursor.execute(base_query, params)"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 213,
        "code": "cursor.execute(\"\"\"\n                SELECT * FROM study_resources \n                WHERE status = 'active'\n                ORDER BY download_count DESC, rating_avg DESC\n                LIMIT ?\n        ...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 236,
        "code": "cursor.execute(\"\"\"\n                    UPDATE study_resources \n                    SET view_count = view_count + 1, updated_at = CURRENT_TIMESTAMP\n                    WHERE id = ?\n                \"\"\",...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 271,
        "code": "cursor.execute(\"\"\"\n                SELECT id FROM resource_ratings \n                WHERE resource_id = ? AND user_id = ?\n            \"\"\", (resource_id, user_id)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 279,
        "code": "cursor.execute(\"\"\"\n                    UPDATE resource_ratings \n                    SET rating = ?, updated_at = CURRENT_TIMESTAMP\n                    WHERE resource_id = ? AND user_id = ?\n           ...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 287,
        "code": "cursor.execute(\"\"\"\n                    INSERT INTO resource_ratings (resource_id, user_id, rating)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 318,
        "code": "cursor.execute(\"\"\"\n                INSERT INTO resource_comments (\n                    resource_id, user_id, user_name, content, parent_id\n                )",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 337,
        "code": "cursor.execute(\"\"\"\n                SELECT * FROM resource_comments \n                WHERE resource_id = ? AND status = 'active'\n                ORDER BY is_pinned DESC, created_at DESC\n               ...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 365,
        "code": "cursor.execute(\"\"\"\n                INSERT INTO resource_downloads (\n                    resource_id, user_id, ip_address, user_agent, status, file_size\n                )",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 392,
        "code": "cursor.execute(\"SELECT * FROM category_stats ORDER BY resource_count DESC\")",
        "context": "cursor.execute(\"SELECT * FROM category_stats ORDER BY resource_count DESC\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 402,
        "code": "cursor.execute(\"SELECT * FROM resource_details WHERE id = ?\", (resource_id,)",
        "context": "cursor.execute(\"SELECT * FROM resource_details WHERE id = ?\", (resource_id,))"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 413,
        "code": "cursor.execute(\"\"\"\n                SELECT \n                    COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 425,
        "code": "cursor.execute(\"\"\"\n                SELECT COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 433,
        "code": "cursor.execute(\"\"\"\n                SELECT \n                    COUNT(*)",
        "context": "cursor.execute(\"\"\""
      }
    ],
    "app\\services\\backup_service.py": [
      {
        "type": "sqlite3_connect",
        "line": 257,
        "code": "sqlite3.connect(self.db_path)",
        "context": "with sqlite3.connect(self.db_path) as conn:"
      },
      {
        "type": "sqlite3_connect",
        "line": 264,
        "code": "sqlite3.connect(self.admin_db_path)",
        "context": "with sqlite3.connect(self.admin_db_path) as conn:"
      }
    ],
    "app\\services\\document_service.py": [
      {
        "type": "UPDATE",
        "line": 98,
        "code": "update_status(\"processing\")\n            text_content = await self._extract_text(file_content, file_type)\n            \n            if not text_content:\n                document.update_status(\"failed\")\n...",
        "context": "document.update_status(\"processing\")"
      }
    ],
    "app\\services\\logging_service.py": [
      {
        "type": "CREATE_TABLE",
        "line": 97,
        "code": "CREATE TABLE IF NOT EXISTS system_logs (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    level TEXT NOT NULL,\n                    category TEXT NOT NULL,\n                ...",
        "context": "CREATE TABLE IF NOT EXISTS system_logs ("
      },
      {
        "type": "INSERT",
        "line": 211,
        "code": "INSERT INTO system_logs (\n                    level, category, message, details, user_id, ip_address,\n                    user_agent, request_id, module, function, line_number, stack_trace\n           ...",
        "context": "INSERT INTO system_logs ("
      },
      {
        "type": "SELECT",
        "line": 415,
        "code": "SELECT * FROM {table}\"\n            params = []\n            \n            if filters:\n                conditions = []\n                for key, value in filters.items():\n                    if key == \"st...",
        "context": "query = f\"SELECT * FROM {table}\""
      },
      {
        "type": "DELETE",
        "line": 558,
        "code": "DELETE FROM {table} \n                    WHERE timestamp < ?\n                \"\"\", (cutoff_date,))\n            \n            conn.commit()\n            \n            self.log_system_event(\n               ...",
        "context": "DELETE FROM {table}"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 96,
        "code": "cursor.execute(\"\"\"\n                CREATE TABLE IF NOT EXISTS system_logs (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    level TEXT NOT NULL,\n                    categ...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 117,
        "code": "cursor.execute(\"\"\"\n                CREATE TABLE IF NOT EXISTS user_action_logs (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    user_id INTEGER NOT NULL,\n               ...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 136,
        "code": "cursor.execute(\"\"\"\n                CREATE TABLE IF NOT EXISTS security_logs (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    event_type TEXT NOT NULL,\n                  ...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 151,
        "code": "cursor.execute(\"\"\"\n                CREATE TABLE IF NOT EXISTS api_access_logs (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    method TEXT NOT NULL,\n                    ...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 168,
        "code": "cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_system_logs_timestamp ON system_logs(timestamp)",
        "context": "cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_system_logs_timestamp ON system_logs(timestamp)\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 169,
        "code": "cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_system_logs_category ON system_logs(category)",
        "context": "cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_system_logs_category ON system_logs(category)\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 170,
        "code": "cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_system_logs_level ON system_logs(level)",
        "context": "cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_system_logs_level ON system_logs(level)\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 171,
        "code": "cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_user_action_logs_user_id ON user_action_logs(user_id)",
        "context": "cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_user_action_logs_user_id ON user_action_logs(user_id)\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 172,
        "code": "cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_user_action_logs_timestamp ON user_action_logs(timestamp)",
        "context": "cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_user_action_logs_timestamp ON user_action_logs(timestamp)\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 173,
        "code": "cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_security_logs_timestamp ON security_logs(timestamp)",
        "context": "cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_security_logs_timestamp ON security_logs(timestamp)\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 174,
        "code": "cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_api_access_logs_timestamp ON api_access_logs(timestamp)",
        "context": "cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_api_access_logs_timestamp ON api_access_logs(timestamp)\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 210,
        "code": "cursor.execute(\"\"\"\n                INSERT INTO system_logs (\n                    level, category, message, details, user_id, ip_address,\n                    user_agent, request_id, module, function, l...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 272,
        "code": "cursor.execute(\"\"\"\n                INSERT INTO user_action_logs (\n                    user_id, action, resource_type, resource_id, old_values,\n                    new_values, ip_address, user_agent, s...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 327,
        "code": "cursor.execute(\"\"\"\n                INSERT INTO security_logs (\n                    event_type, user_id, ip_address, user_agent, details, risk_level, blocked\n                )",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 380,
        "code": "cursor.execute(\"\"\"\n                INSERT INTO api_access_logs (\n                    method, endpoint, user_id, ip_address, user_agent,\n                    request_body, response_status, response_time...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 443,
        "code": "cursor.execute(query, params)",
        "context": "cursor.execute(query, params)"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 474,
        "code": "cursor.execute(\"\"\"\n                SELECT level, COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 481,
        "code": "cursor.execute(\"\"\"\n                SELECT category, COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 489,
        "code": "cursor.execute(\"\"\"\n                SELECT COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 495,
        "code": "cursor.execute(\"\"\"\n                SELECT COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 502,
        "code": "cursor.execute(\"\"\"\n                SELECT risk_level, COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 510,
        "code": "cursor.execute(\"\"\"\n                SELECT COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 516,
        "code": "cursor.execute(\"\"\"\n                SELECT AVG(response_time)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 557,
        "code": "cursor.execute(f\"\"\"\n                    DELETE FROM {table} \n                    WHERE timestamp < ?\n                \"\"\", (cutoff_date,)",
        "context": "cursor.execute(f\"\"\""
      }
    ],
    "app\\services\\vector_store_service.py": [
      {
        "type": "UPDATE",
        "line": 196,
        "code": "update(metadata)\n                metadatas.append(chunk_metadata)\n            \n            # 添加到集合\n            self.chroma_collection.add(\n                ids=ids,\n                embeddings=embedding...",
        "context": "chunk_metadata.update(metadata)"
      }
    ],
    "database\\config.py": [
      {
        "type": "SELECT",
        "line": 104,
        "code": "SELECT 1\")\n                if result == 1:\n                    logger.info(\"数据库连接测试成功\")\n                    return True\n                else:\n                    logger.error(\"数据库连接测试失败\")\n            ...",
        "context": "result = await conn.fetchval(\"SELECT 1\")"
      }
    ],
    "database\\init_db.py": [
      {
        "type": "CREATE_TABLE",
        "line": 14,
        "code": "CREATE TABLE IF NOT EXISTS users (\n    id SERIAL PRIMARY KEY,\n    email VARCHAR(255) UNIQUE NOT NULL,\n    username VARCHAR(100) NOT NULL,\n    password_hash VARCHAR(255) NOT NULL,\n    is_active BOOLEAN...",
        "context": "CREATE TABLE IF NOT EXISTS users ("
      },
      {
        "type": "SELECT",
        "line": 66,
        "code": "SELECT 1 FROM information_schema.table_constraints \n        WHERE constraint_name = 'check_email_format' \n        AND table_name = 'users'\n    ) THEN\n        ALTER TABLE users \n        ADD CONSTRAINT ...",
        "context": "SELECT 1 FROM information_schema.table_constraints"
      },
      {
        "type": "SELECT",
        "line": 80,
        "code": "SELECT 1 FROM information_schema.table_constraints \n        WHERE constraint_name = 'check_username_length' \n        AND table_name = 'users'\n    ) THEN\n        ALTER TABLE users \n        ADD CONSTRAI...",
        "context": "SELECT 1 FROM information_schema.table_constraints"
      },
      {
        "type": "SELECT",
        "line": 144,
        "code": "SELECT table_name FROM information_schema.tables \n                WHERE table_name = 'users' AND table_schema = 'public'\n            \"\"\")\n            \n            if result:\n                print(\"🎉 用...",
        "context": "SELECT table_name FROM information_schema.tables"
      }
    ],
    "database\\models.py": [
      {
        "type": "INSERT",
        "line": 61,
        "code": "INSERT INTO users (email, username, password_hash, is_active, is_verified, profile)\n            VALUES (%s, %s, %s, %s, %s, %s)\n            RETURNING id, created_at, updated_at\n        \"\"\"\n        \n  ...",
        "context": "INSERT INTO users (email, username, password_hash, is_active, is_verified, profile)"
      },
      {
        "type": "SELECT",
        "line": 88,
        "code": "SELECT id, email, username, password_hash, is_active, is_verified,\n                   created_at, updated_at, last_login, profile\n            FROM users WHERE email = %s\n        \"\"\"\n        \n        c...",
        "context": "SELECT id, email, username, password_hash, is_active, is_verified,"
      },
      {
        "type": "UPDATE",
        "line": 28,
        "code": "updated_at: Optional[datetime] = None\n    last_login: Optional[datetime] = None\n    profile: Dict[str, Any] = None\n    \n    def __post_init__(self):\n        if self.profile is None:\n            self.p...",
        "context": "updated_at: Optional[datetime] = None"
      },
      {
        "type": "DELETE",
        "line": 379,
        "code": "DELETE FROM documents WHERE id = $1\"\n        async with db_config.get_connection() as conn:\n            await conn.execute(query, self.id)\n\n@dataclass\nclass DocumentChunk:\n    \"\"\"文档块模型\"\"\"\n    id: Opti...",
        "context": "query = \"DELETE FROM documents WHERE id = $1\""
      }
    ],
    "database\\simple_init.py": [
      {
        "type": "sqlite3_connect",
        "line": 16,
        "code": "sqlite3.connect(str(db_path)",
        "context": "conn = sqlite3.connect(str(db_path))"
      },
      {
        "type": "sqlite3_connect",
        "line": 108,
        "code": "sqlite3.connect(str(self.db_path)",
        "context": "return sqlite3.connect(str(self.db_path))"
      },
      {
        "type": "CREATE_TABLE",
        "line": 24,
        "code": "CREATE TABLE IF NOT EXISTS users (\n                id INTEGER PRIMARY KEY AUTOINCREMENT,\n                email TEXT UNIQUE NOT NULL,\n                username TEXT NOT NULL,\n                password_ha...",
        "context": "CREATE TABLE IF NOT EXISTS users ("
      },
      {
        "type": "UPDATE",
        "line": 32,
        "code": "updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                last_login TIMESTAMP,\n                profile TEXT DEFAULT '{}'\n            )\n        \"\"\")\n        print(\"✅ 用户表创建成功\")\n        \n        #...",
        "context": "updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,"
      },
      {
        "type": "PRAGMA",
        "line": 61,
        "code": "PRAGMA table_info(users)\")\n        columns = cursor.fetchall()\n        \n        print(\"\\n📋 用户表结构:\")\n        print(\"-\" * 60)\n        for col in columns:\n            col_id, name, data_type, not_null, d...",
        "context": "cursor.execute(\"PRAGMA table_info(users)\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 23,
        "code": "cursor.execute(\"\"\"\n            CREATE TABLE IF NOT EXISTS users (\n                id INTEGER PRIMARY KEY AUTOINCREMENT,\n                email TEXT UNIQUE NOT NULL,\n                username TEXT NOT NU...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 40,
        "code": "cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_users_email ON users(email)",
        "context": "cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_users_email ON users(email)\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 41,
        "code": "cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_users_username ON users(username)",
        "context": "cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_users_username ON users(username)\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 42,
        "code": "cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_users_is_active ON users(is_active)",
        "context": "cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_users_is_active ON users(is_active)\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 43,
        "code": "cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_users_is_verified ON users(is_verified)",
        "context": "cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_users_is_verified ON users(is_verified)\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 47,
        "code": "cursor.execute(\"\"\"\n            CREATE TRIGGER IF NOT EXISTS update_users_updated_at\n            AFTER UPDATE ON users\n            FOR EACH ROW\n            BEGIN\n                UPDATE users SET update...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 61,
        "code": "cursor.execute(\"PRAGMA table_info(users)",
        "context": "cursor.execute(\"PRAGMA table_info(users)\")"
      }
    ],
    "database\\sqlite_config.py": [
      {
        "type": "sqlite3_connect",
        "line": 21,
        "code": "sqlite3.connect(str(self.db_path)",
        "context": "return sqlite3.connect(str(self.db_path))"
      }
    ],
    "database\\study_resources_models.py": [
      {
        "type": "sqlite3_connect",
        "line": 31,
        "code": "sqlite3.connect(str(db_path)",
        "context": "conn = sqlite3.connect(str(db_path))"
      },
      {
        "type": "sqlite3_connect",
        "line": 72,
        "code": "sqlite3.connect(str(db_path)",
        "context": "conn = sqlite3.connect(str(db_path))"
      },
      {
        "type": "sqlite3_connect",
        "line": 122,
        "code": "sqlite3.connect(str(db_path)",
        "context": "conn = sqlite3.connect(str(db_path))"
      },
      {
        "type": "sqlite3_connect",
        "line": 176,
        "code": "sqlite3.connect(str(db_path)",
        "context": "conn = sqlite3.connect(str(db_path))"
      },
      {
        "type": "sqlite3_connect",
        "line": 208,
        "code": "sqlite3.connect(str(db_path)",
        "context": "conn = sqlite3.connect(str(db_path))"
      },
      {
        "type": "sqlite3_connect",
        "line": 240,
        "code": "sqlite3.connect(str(db_path)",
        "context": "conn = sqlite3.connect(str(db_path))"
      },
      {
        "type": "sqlite3_connect",
        "line": 271,
        "code": "sqlite3.connect(str(db_path)",
        "context": "conn = sqlite3.connect(str(db_path))"
      },
      {
        "type": "sqlite3_connect",
        "line": 311,
        "code": "sqlite3.connect(str(self.db_path)",
        "context": "conn = sqlite3.connect(str(self.db_path))"
      },
      {
        "type": "sqlite3_connect",
        "line": 325,
        "code": "sqlite3.connect(str(self.db_path)",
        "context": "conn = sqlite3.connect(str(self.db_path))"
      },
      {
        "type": "sqlite3_connect",
        "line": 351,
        "code": "sqlite3.connect(str(self.db_path)",
        "context": "conn = sqlite3.connect(str(self.db_path))"
      },
      {
        "type": "sqlite3_connect",
        "line": 457,
        "code": "sqlite3.connect(str(self.db_path)",
        "context": "conn = sqlite3.connect(str(self.db_path))"
      },
      {
        "type": "sqlite3_connect",
        "line": 523,
        "code": "sqlite3.connect(str(self.db_path)",
        "context": "conn = sqlite3.connect(str(self.db_path))"
      },
      {
        "type": "sqlite3_connect",
        "line": 552,
        "code": "sqlite3.connect(str(self.db_path)",
        "context": "conn = sqlite3.connect(str(self.db_path))"
      },
      {
        "type": "sqlite3_connect",
        "line": 575,
        "code": "sqlite3.connect(str(self.db_path)",
        "context": "conn = sqlite3.connect(str(self.db_path))"
      },
      {
        "type": "sqlite3_connect",
        "line": 601,
        "code": "sqlite3.connect(str(self.db_path)",
        "context": "conn = sqlite3.connect(str(self.db_path))"
      },
      {
        "type": "sqlite3_connect",
        "line": 622,
        "code": "sqlite3.connect(str(self.db_path)",
        "context": "conn = sqlite3.connect(str(self.db_path))"
      },
      {
        "type": "INSERT",
        "line": 35,
        "code": "INSERT INTO resource_categories (name, code, description, icon, created_at)\n                VALUES (?, ?, ?, ?, ?)\n            \"\"\", (self.name, self.code, self.description, self.icon, self.created_at)...",
        "context": "INSERT INTO resource_categories (name, code, description, icon, created_at)"
      },
      {
        "type": "SELECT",
        "line": 91,
        "code": "SELECT id FROM resource_tags WHERE name = ?\", (tag_name,))\n                    tag_result = cursor.fetchone()\n                    \n                    if tag_result:\n                        tag_id = t...",
        "context": "cursor.execute(\"SELECT id FROM resource_tags WHERE name = ?\", (tag_name,))"
      },
      {
        "type": "UPDATE",
        "line": 66,
        "code": "updated_at = datetime.now()\n    \n    async def create(self) -> int:\n        \"\"\"创建新资源\"\"\"\n        try:\n            db_path = Path(__file__).parent.parent / \"data\" / \"study_resources.db\"\n            conn...",
        "context": "self.updated_at = datetime.now()"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 34,
        "code": "cursor.execute(\"\"\"\n                INSERT INTO resource_categories (name, code, description, icon, created_at)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 76,
        "code": "cursor.execute(\"\"\"\n                INSERT INTO study_resources \n                (name, description, category_id, file_name, file_path, file_size, \n                 file_type, upload_time, updated_at)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 91,
        "code": "cursor.execute(\"SELECT id FROM resource_tags WHERE name = ?\", (tag_name,)",
        "context": "cursor.execute(\"SELECT id FROM resource_tags WHERE name = ?\", (tag_name,))"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 98,
        "code": "cursor.execute(\"INSERT INTO resource_tags (name)",
        "context": "cursor.execute(\"INSERT INTO resource_tags (name) VALUES (?)\", (tag_name,))"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 102,
        "code": "cursor.execute(\"\"\"\n                        INSERT INTO resource_tag_relations (resource_id, tag_id)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 126,
        "code": "cursor.execute(\"\"\"\n                SELECT r.*, c.name as category_name\n                FROM study_resources r\n                LEFT JOIN resource_categories c ON r.category_id = c.id\n                WH...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 179,
        "code": "cursor.execute(\"\"\"\n                UPDATE study_resources \n                SET status = 'deleted', updated_at = ?\n                WHERE id = ?\n            \"\"\", (datetime.now()",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 211,
        "code": "cursor.execute(\"\"\"\n                INSERT INTO resource_ratings (resource_id, user_id, rating, created_at)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 243,
        "code": "cursor.execute(\"\"\"\n                INSERT INTO resource_comments (resource_id, user_id, content, parent_id, created_at)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 274,
        "code": "cursor.execute(\"\"\"\n                INSERT INTO resource_downloads (resource_id, user_id, ip_address, download_time)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 329,
        "code": "cursor.execute(\"\"\"\n                SELECT c.*, COUNT(r.id)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 412,
        "code": "cursor.execute(query, params)",
        "context": "cursor.execute(query, params)"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 500,
        "code": "cursor.execute(query, params)",
        "context": "cursor.execute(query, params)"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 527,
        "code": "cursor.execute(\"\"\"\n                SELECT \n                    COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 556,
        "code": "cursor.execute(\"\"\"\n                SELECT *\n                FROM resource_comments\n                WHERE resource_id = ? AND status = 'active'\n                ORDER BY is_pinned DESC, created_at DESC\n...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 581,
        "code": "cursor.execute(\"\"\"\n                SELECT *\n                FROM resource_comments\n                WHERE resource_id = ? AND status = 'active'\n                ORDER BY is_pinned DESC, created_at DESC\n...",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 604,
        "code": "cursor.execute(\"\"\"\n                SELECT COUNT(*)",
        "context": "cursor.execute(\"\"\""
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 627,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM resource_categories\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 630,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM study_resources WHERE status = 'active'\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 633,
        "code": "cursor.execute(\"SELECT COUNT(*)",
        "context": "cursor.execute(\"SELECT COUNT(*) FROM resource_downloads\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 636,
        "code": "cursor.execute(\"SELECT SUM(file_size)",
        "context": "cursor.execute(\"SELECT SUM(file_size) FROM study_resources WHERE status = 'active'\")"
      },
      {
        "type": "CURSOR_EXECUTE",
        "line": 640,
        "code": "cursor.execute(\"\"\"\n                SELECT c.name, COUNT(r.id)",
        "context": "cursor.execute(\"\"\""
      }
    ]
  },
  "compatibility_issues": [
    {
      "file": "auth_routes.py",
      "line": 185,
      "issue": "CURRENT_TIMESTAMP",
      "code": "cursor.execute(\"\"\"\n            UPDATE users SET is_verified = ?, updated_at = CURRENT_TIMESTAMP\n            WHERE email = ?\n        \"\"\", (is_verified, email)",
      "severity": "medium"
    },
    {
      "file": "auth_routes.py",
      "line": 198,
      "issue": "CURRENT_TIMESTAMP",
      "code": "cursor.execute(\"\"\"\n            UPDATE users SET last_login = CURRENT_TIMESTAMP, updated_at = CURRENT_TIMESTAMP\n            WHERE id = ?\n        \"\"\", (user_id,)",
      "severity": "medium"
    },
    {
      "file": "check_db.py",
      "line": 9,
      "issue": "PRAGMA",
      "code": "SELECT name FROM sqlite_master WHERE type='table'\")\ntables = cursor.fetchall()\nprint(\"Tables:\", tables)\n\n# 检查users表结构\ncursor.execute(\"PRAGMA table_info(users)\")\nschema = cursor.fetchall()\nprint(\"Users...",
      "severity": "high"
    },
    {
      "file": "check_db.py",
      "line": 9,
      "issue": "sqlite_master",
      "code": "SELECT name FROM sqlite_master WHERE type='table'\")\ntables = cursor.fetchall()\nprint(\"Tables:\", tables)\n\n# 检查users表结构\ncursor.execute(\"PRAGMA table_info(users)\")\nschema = cursor.fetchall()\nprint(\"Users...",
      "severity": "medium"
    },
    {
      "file": "check_db.py",
      "line": 14,
      "issue": "PRAGMA",
      "code": "PRAGMA table_info(users)\")\nschema = cursor.fetchall()\nprint(\"Users table schema:\", schema)\n\n# 检查users表中的数据\ncursor.execute(\"SELECT COUNT(*) FROM users\")\ncount = cursor.fetchone()[0]\nprint(f\"Total users...",
      "severity": "high"
    },
    {
      "file": "check_db.py",
      "line": 9,
      "issue": "sqlite_master",
      "code": "cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table'\")",
      "severity": "medium"
    },
    {
      "file": "check_db.py",
      "line": 14,
      "issue": "PRAGMA",
      "code": "cursor.execute(\"PRAGMA table_info(users)",
      "severity": "high"
    },
    {
      "file": "check_db_schema.py",
      "line": 23,
      "issue": "PRAGMA",
      "code": "PRAGMA table_info(resource_categories)\")\n        columns = cursor.fetchall()\n        \n        if not columns:\n            print(\"❌ resource_categories表不存在\")\n        else:\n            print(\"✅ resource...",
      "severity": "high"
    },
    {
      "file": "check_db_schema.py",
      "line": 23,
      "issue": "PRAGMA",
      "code": "cursor.execute(\"PRAGMA table_info(resource_categories)",
      "severity": "high"
    },
    {
      "file": "check_db_schema.py",
      "line": 56,
      "issue": "PRAGMA",
      "code": "cursor.execute(\"PRAGMA table_info(study_resources)",
      "severity": "high"
    },
    {
      "file": "check_db_temp.py",
      "line": 16,
      "issue": "sqlite_master",
      "code": "SELECT name FROM sqlite_master WHERE type='table' AND name='admin_users'\")\n    table_exists = cursor.fetchone()\n    print(f'admin_users表存在: {table_exists is not None}')\n    \n    if table_exists:\n     ...",
      "severity": "medium"
    },
    {
      "file": "check_db_temp.py",
      "line": 27,
      "issue": "PRAGMA",
      "code": "PRAGMA table_info(admin_users)\")\n        columns = cursor.fetchall()\n        print('\\n表结构:')\n        for col in columns:\n            print(f'  {col[1]} ({col[2]})')\n        \n        # 查询前5个用户的基本信息\n   ...",
      "severity": "high"
    },
    {
      "file": "check_db_temp.py",
      "line": 16,
      "issue": "sqlite_master",
      "code": "cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table' AND name='admin_users'\")",
      "severity": "medium"
    },
    {
      "file": "check_db_temp.py",
      "line": 27,
      "issue": "PRAGMA",
      "code": "cursor.execute(\"PRAGMA table_info(admin_users)",
      "severity": "high"
    },
    {
      "file": "check_tables.py",
      "line": 9,
      "issue": "sqlite_master",
      "code": "SELECT name FROM sqlite_master WHERE type='table'\")\n    tables = cursor.fetchall()\n    \n    print(\"数据库中的表:\")\n    for table in tables:\n        print(f\"- {table[0]}\")\n    \n    conn.close()\nexcept Except...",
      "severity": "medium"
    },
    {
      "file": "check_tables.py",
      "line": 35,
      "issue": "PRAGMA",
      "code": "PRAGMA table_info(users)\")\n        columns = cursor.fetchall()\n        print(\"\\nusers表结构:\")\n        for col in columns:\n            print(f\"  {col[1]} {col[2]}\")\n    \n    conn.close()\nexcept Exception...",
      "severity": "high"
    },
    {
      "file": "check_tables.py",
      "line": 9,
      "issue": "sqlite_master",
      "code": "cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table'\")",
      "severity": "medium"
    },
    {
      "file": "check_tables.py",
      "line": 26,
      "issue": "sqlite_master",
      "code": "cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table'\")",
      "severity": "medium"
    },
    {
      "file": "check_tables.py",
      "line": 35,
      "issue": "PRAGMA",
      "code": "cursor.execute(\"PRAGMA table_info(users)",
      "severity": "high"
    },
    {
      "file": "check_users_table.py",
      "line": 15,
      "issue": "sqlite_master",
      "code": "SELECT name FROM sqlite_master WHERE type='table' AND name='users'\")\n    users_table_exists = cursor.fetchone() is not None\n    print(f'users表存在: {users_table_exists}')\n    \n    if users_table_exists:...",
      "severity": "medium"
    },
    {
      "file": "check_users_table.py",
      "line": 26,
      "issue": "PRAGMA",
      "code": "PRAGMA table_info(users)\")\n        columns = cursor.fetchall()\n        print('\\nusers表结构:')\n        for col in columns:\n            print(f'  {col[1]} ({col[2]})')\n        \n        # 查询前5个用户的基本信息\n    ...",
      "severity": "high"
    },
    {
      "file": "check_users_table.py",
      "line": 15,
      "issue": "sqlite_master",
      "code": "cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table' AND name='users'\")",
      "severity": "medium"
    },
    {
      "file": "check_users_table.py",
      "line": 26,
      "issue": "PRAGMA",
      "code": "cursor.execute(\"PRAGMA table_info(users)",
      "severity": "high"
    },
    {
      "file": "app\\models\\document.py",
      "line": 42,
      "issue": "AUTOINCREMENT",
      "code": "CREATE TABLE IF NOT EXISTS categories (\n                        id INTEGER PRIMARY KEY AUTOINCREMENT,\n                        name TEXT NOT NULL UNIQUE,\n                        description TEXT,\n     ...",
      "severity": "high"
    },
    {
      "file": "app\\models\\document.py",
      "line": 42,
      "issue": "INTEGER PRIMARY KEY",
      "code": "CREATE TABLE IF NOT EXISTS categories (\n                        id INTEGER PRIMARY KEY AUTOINCREMENT,\n                        name TEXT NOT NULL UNIQUE,\n                        description TEXT,\n     ...",
      "severity": "high"
    },
    {
      "file": "app\\models\\document.py",
      "line": 41,
      "issue": "AUTOINCREMENT",
      "code": "cursor.execute('''\n                    CREATE TABLE IF NOT EXISTS categories (\n                        id INTEGER PRIMARY KEY AUTOINCREMENT,\n                        name TEXT NOT NULL UNIQUE,\n        ...",
      "severity": "high"
    },
    {
      "file": "app\\models\\document.py",
      "line": 41,
      "issue": "INTEGER PRIMARY KEY",
      "code": "cursor.execute('''\n                    CREATE TABLE IF NOT EXISTS categories (\n                        id INTEGER PRIMARY KEY AUTOINCREMENT,\n                        name TEXT NOT NULL UNIQUE,\n        ...",
      "severity": "high"
    },
    {
      "file": "app\\models\\document.py",
      "line": 225,
      "issue": "AUTOINCREMENT",
      "code": "cursor.execute('''\n                    CREATE TABLE IF NOT EXISTS tags (\n                        id INTEGER PRIMARY KEY AUTOINCREMENT,\n                        name TEXT NOT NULL UNIQUE,\n              ...",
      "severity": "high"
    },
    {
      "file": "app\\models\\document.py",
      "line": 225,
      "issue": "INTEGER PRIMARY KEY",
      "code": "cursor.execute('''\n                    CREATE TABLE IF NOT EXISTS tags (\n                        id INTEGER PRIMARY KEY AUTOINCREMENT,\n                        name TEXT NOT NULL UNIQUE,\n              ...",
      "severity": "high"
    },
    {
      "file": "app\\models\\document.py",
      "line": 336,
      "issue": "AUTOINCREMENT",
      "code": "cursor.execute('''\n                    CREATE TABLE IF NOT EXISTS documents (\n                        id INTEGER PRIMARY KEY AUTOINCREMENT,\n                        filename TEXT NOT NULL,\n            ...",
      "severity": "high"
    },
    {
      "file": "app\\models\\document.py",
      "line": 336,
      "issue": "INTEGER PRIMARY KEY",
      "code": "cursor.execute('''\n                    CREATE TABLE IF NOT EXISTS documents (\n                        id INTEGER PRIMARY KEY AUTOINCREMENT,\n                        filename TEXT NOT NULL,\n            ...",
      "severity": "high"
    },
    {
      "file": "app\\models\\document.py",
      "line": 352,
      "issue": "AUTOINCREMENT",
      "code": "cursor.execute('''\n                    CREATE TABLE IF NOT EXISTS document_tags (\n                        id INTEGER PRIMARY KEY AUTOINCREMENT,\n                        document_id INTEGER NOT NULL,\n  ...",
      "severity": "high"
    },
    {
      "file": "app\\models\\document.py",
      "line": 352,
      "issue": "INTEGER PRIMARY KEY",
      "code": "cursor.execute('''\n                    CREATE TABLE IF NOT EXISTS document_tags (\n                        id INTEGER PRIMARY KEY AUTOINCREMENT,\n                        document_id INTEGER NOT NULL,\n  ...",
      "severity": "high"
    },
    {
      "file": "app\\models\\document.py",
      "line": 856,
      "issue": "AUTOINCREMENT",
      "code": "cursor.execute('''\n            CREATE TABLE IF NOT EXISTS document_chunks (\n                id INTEGER PRIMARY KEY AUTOINCREMENT,\n                document_id INTEGER NOT NULL,\n                chunk_in...",
      "severity": "high"
    },
    {
      "file": "app\\models\\document.py",
      "line": 856,
      "issue": "INTEGER PRIMARY KEY",
      "code": "cursor.execute('''\n            CREATE TABLE IF NOT EXISTS document_chunks (\n                id INTEGER PRIMARY KEY AUTOINCREMENT,\n                document_id INTEGER NOT NULL,\n                chunk_in...",
      "severity": "high"
    },
    {
      "file": "app\\models\\study_resources.py",
      "line": 236,
      "issue": "CURRENT_TIMESTAMP",
      "code": "cursor.execute(\"\"\"\n                    UPDATE study_resources \n                    SET view_count = view_count + 1, updated_at = CURRENT_TIMESTAMP\n                    WHERE id = ?\n                \"\"\",...",
      "severity": "medium"
    },
    {
      "file": "app\\models\\study_resources.py",
      "line": 279,
      "issue": "CURRENT_TIMESTAMP",
      "code": "cursor.execute(\"\"\"\n                    UPDATE resource_ratings \n                    SET rating = ?, updated_at = CURRENT_TIMESTAMP\n                    WHERE resource_id = ? AND user_id = ?\n           ...",
      "severity": "medium"
    },
    {
      "file": "app\\services\\logging_service.py",
      "line": 97,
      "issue": "AUTOINCREMENT",
      "code": "CREATE TABLE IF NOT EXISTS system_logs (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    level TEXT NOT NULL,\n                    category TEXT NOT NULL,\n                ...",
      "severity": "high"
    },
    {
      "file": "app\\services\\logging_service.py",
      "line": 97,
      "issue": "INTEGER PRIMARY KEY",
      "code": "CREATE TABLE IF NOT EXISTS system_logs (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    level TEXT NOT NULL,\n                    category TEXT NOT NULL,\n                ...",
      "severity": "high"
    },
    {
      "file": "app\\services\\logging_service.py",
      "line": 96,
      "issue": "AUTOINCREMENT",
      "code": "cursor.execute(\"\"\"\n                CREATE TABLE IF NOT EXISTS system_logs (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    level TEXT NOT NULL,\n                    categ...",
      "severity": "high"
    },
    {
      "file": "app\\services\\logging_service.py",
      "line": 96,
      "issue": "INTEGER PRIMARY KEY",
      "code": "cursor.execute(\"\"\"\n                CREATE TABLE IF NOT EXISTS system_logs (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    level TEXT NOT NULL,\n                    categ...",
      "severity": "high"
    },
    {
      "file": "app\\services\\logging_service.py",
      "line": 117,
      "issue": "AUTOINCREMENT",
      "code": "cursor.execute(\"\"\"\n                CREATE TABLE IF NOT EXISTS user_action_logs (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    user_id INTEGER NOT NULL,\n               ...",
      "severity": "high"
    },
    {
      "file": "app\\services\\logging_service.py",
      "line": 117,
      "issue": "INTEGER PRIMARY KEY",
      "code": "cursor.execute(\"\"\"\n                CREATE TABLE IF NOT EXISTS user_action_logs (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    user_id INTEGER NOT NULL,\n               ...",
      "severity": "high"
    },
    {
      "file": "app\\services\\logging_service.py",
      "line": 136,
      "issue": "AUTOINCREMENT",
      "code": "cursor.execute(\"\"\"\n                CREATE TABLE IF NOT EXISTS security_logs (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    event_type TEXT NOT NULL,\n                  ...",
      "severity": "high"
    },
    {
      "file": "app\\services\\logging_service.py",
      "line": 136,
      "issue": "INTEGER PRIMARY KEY",
      "code": "cursor.execute(\"\"\"\n                CREATE TABLE IF NOT EXISTS security_logs (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    event_type TEXT NOT NULL,\n                  ...",
      "severity": "high"
    },
    {
      "file": "app\\services\\logging_service.py",
      "line": 151,
      "issue": "AUTOINCREMENT",
      "code": "cursor.execute(\"\"\"\n                CREATE TABLE IF NOT EXISTS api_access_logs (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    method TEXT NOT NULL,\n                    ...",
      "severity": "high"
    },
    {
      "file": "app\\services\\logging_service.py",
      "line": 151,
      "issue": "INTEGER PRIMARY KEY",
      "code": "cursor.execute(\"\"\"\n                CREATE TABLE IF NOT EXISTS api_access_logs (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    method TEXT NOT NULL,\n                    ...",
      "severity": "high"
    },
    {
      "file": "database\\simple_init.py",
      "line": 24,
      "issue": "AUTOINCREMENT",
      "code": "CREATE TABLE IF NOT EXISTS users (\n                id INTEGER PRIMARY KEY AUTOINCREMENT,\n                email TEXT UNIQUE NOT NULL,\n                username TEXT NOT NULL,\n                password_ha...",
      "severity": "high"
    },
    {
      "file": "database\\simple_init.py",
      "line": 24,
      "issue": "INTEGER PRIMARY KEY",
      "code": "CREATE TABLE IF NOT EXISTS users (\n                id INTEGER PRIMARY KEY AUTOINCREMENT,\n                email TEXT UNIQUE NOT NULL,\n                username TEXT NOT NULL,\n                password_ha...",
      "severity": "high"
    },
    {
      "file": "database\\simple_init.py",
      "line": 32,
      "issue": "CURRENT_TIMESTAMP",
      "code": "updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                last_login TIMESTAMP,\n                profile TEXT DEFAULT '{}'\n            )\n        \"\"\")\n        print(\"✅ 用户表创建成功\")\n        \n        #...",
      "severity": "medium"
    },
    {
      "file": "database\\simple_init.py",
      "line": 61,
      "issue": "PRAGMA",
      "code": "PRAGMA table_info(users)\")\n        columns = cursor.fetchall()\n        \n        print(\"\\n📋 用户表结构:\")\n        print(\"-\" * 60)\n        for col in columns:\n            col_id, name, data_type, not_null, d...",
      "severity": "high"
    },
    {
      "file": "database\\simple_init.py",
      "line": 23,
      "issue": "AUTOINCREMENT",
      "code": "cursor.execute(\"\"\"\n            CREATE TABLE IF NOT EXISTS users (\n                id INTEGER PRIMARY KEY AUTOINCREMENT,\n                email TEXT UNIQUE NOT NULL,\n                username TEXT NOT NU...",
      "severity": "high"
    },
    {
      "file": "database\\simple_init.py",
      "line": 23,
      "issue": "INTEGER PRIMARY KEY",
      "code": "cursor.execute(\"\"\"\n            CREATE TABLE IF NOT EXISTS users (\n                id INTEGER PRIMARY KEY AUTOINCREMENT,\n                email TEXT UNIQUE NOT NULL,\n                username TEXT NOT NU...",
      "severity": "high"
    },
    {
      "file": "database\\simple_init.py",
      "line": 61,
      "issue": "PRAGMA",
      "code": "cursor.execute(\"PRAGMA table_info(users)",
      "severity": "high"
    }
  ]
}