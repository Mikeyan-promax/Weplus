; supervisord 配置：同容器内启动后端 Uvicorn 与 Nginx
[supervisord]
nodaemon=true
logfile=/var/log/supervisord.log
pidfile=/var/run/supervisord.pid

[program:backend]
directory=/app
command=/usr/local/bin/uvicorn main:app --host 0.0.0.0 --port 8000
autostart=true
autorestart=true
stdout_logfile=/var/log/backend.stdout.log
stderr_logfile=/var/log/backend.stderr.log
priority=10

[program:nginx]
command=/bin/sh -c 'envsubst < /etc/nginx/nginx.conf.template > /etc/nginx/nginx.conf && /usr/sbin/nginx -t && echo "[startup] Nginx will listen on PORT=$PORT" && /usr/sbin/nginx -g "daemon off;"'
autostart=true
autorestart=true
stdout_logfile=/var/log/nginx.stdout.log
stderr_logfile=/var/log/nginx.stderr.log
priority=20
